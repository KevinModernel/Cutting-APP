doctype html
html(lang='en')
    head
      meta(charset="utf-8")
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
      title Cutting Weigth
      style.
        body { 
          display: grid;
          grid-template-areas: 
            "header header"
            "nav article"
            "ads article"
            "ads footer";
          grid-template-rows: 80px 15fr 200px 5000px;  
          grid-template-columns: 25% 3fr;
          grid-row-gap: 10px;
          grid-column-gap: 10px;
          height: 100vh;
          margin: 0;
          }  
        header, footer, article, nav, div {
          padding: 0.3em;
          background: #111111;
          }
        #pageHeader {
          grid-area: header;
          }
        #pageFooter {
          grid-area: footer;
          }
        #mainArticle { 
          grid-area: article;      
          }
        #mainNav { 
          grid-area: nav; 
          }
        #siteAds { 
          grid-area: ads; 
          } 
        /* Stack the layout on small devices/viewports. */
        @media all and (max-width: 575px) {
          body { 
            grid-template-areas: 
              "header"
              "article"
              "ads"
              "nav"
              "footer";
            grid-template-rows: 80px 1fr 70px 1fr 70px;  
            grid-template-columns: 1fr;
         }
        }
        #outer {
          width:100%;
          display: flex;
          justify-content: center;
        }
      
      meta(content="width=device-width, initial-scale=1.0", name="viewport")    
    body(style="background-color:black")
      header#pageHeader
        h1.text-center.mb-4(style="color:#2069e0") Panel de Journey: #{journey.journeyName}
      article#mainArticle
        h1.text-center.mb-4(style="color:#2069e0") Gráfico Seguimiento Diario:
        #tester(style="width:1000px;height:250px;")   
      nav#mainNav
        h2.text-center(style="color:#2069e0") Ingresar Fecha / Peso:
        .mx-auto(style="width: 100%; max-width: 300px;")
          .input-group
            .container.text-center        
              form#form1.form(action='/newmeasure', method='POST')
                  h5(style="color:#bebebe") Fecha:
                  input(type="date", required=true, name='date', value='')
                  br
                  br
                  h5(style="color:#bebebe") Peso:
                  input(type="text", placeholder="Ingresar peso", aria-label="ingresar peso" ,required=true, name='weight', value='')
                  br
                  input(type="hidden", placeholder="foreign key", required=true, name='journeyId', value=`${journey.id}`)        
                  br
                  input(type="submit", value="Cargar")
      #siteAds
        if dailyProgress
          h2(style="color:#2069e0") Seguimiento Diario:
          table.table(id='myTable')
            thead
              tr(style="color:#bebebe")
                th Fecha
                th Peso
                th Delta Diario
                th Peso Objetivo
                th Eliminar
            tbody
              each day in dailyProgress
                tr(style="color:#bebebe")
                  td.X #{day.date}
                  td.Y #{day.weight}
                  td #{day.dailyVariation}
                  td.YSecond #{day.goalWeight}
                  td
                    form(action=`/deleteday/${day.id}`, method='POST')
                      button(type='submit') ✘
      footer#pageFooter
        if goal
          h2.text-center(style="color:#2069e0") Final Goals:
          table.table
            thead
              tr(style="color:#bebebe")
                th Peso Final [kg]
                th Grasa Corporal (%)
                th Fecha Final
                th Días Restantes
                th Pérdida Diaria Objetivo [kg]
            tbody
              tr(style="color:#bebebe")
                td #{goal.bw}
                td #{goal.bf}
                td #{goal.endDate}
                td #{aditionalData.daysUntilEnd}
                td #{aditionalData.dailyDelta}
        else 
          h3.text-primary.mb-4 Cargar Goals para este Journey:     
          form(action='/newgoal', method='POST')
            label bw:
            br
            input(type="text", placeholder="Ingrese el bw", required=true, name='bw', value='')
            br
            label bf:
            br
            input(type="number", placeholder="Ingrese su bf", required=true, name='bf', value='')
            br
            label end date
            br
            input(type="date", placeholder="Ingrese su BF %", required=true, name='endDate', value='')
            br
            label Foreign key:
            br
            input(type="number", placeholder="foreign key", required=true, name='journeyId', value=`${journey.id}`)
            input(type="submit", value="Submit")
    footer
      script(src="https://code.jquery.com/jquery-3.4.1.min.js")
      script(src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js")   
      script(src="https://cdn.plot.ly/plotly-2.17.1.min.js")
      script.
        (function (dailyProgress) {
          TESTER = document.getElementById('tester');
          let x = [];
          let newX;

          let y = [];
          let newY;

          let ySecond = [];
          let newYSecond;

          // get the table
          let table = document.getElementById( 'myTable' );

          // get table rows
          let rows = table.getElementsByTagName( 'tr' );

          for (let i=1; i < rows.length; i++) {
            newX = rows[i].cells[0].innerText;
            x.push(newX);
            newY = rows[i].cells[1].innerText
            y.push(newY);
            newYSecond = rows[i].cells[3].innerText;
            ySecond.push(newYSecond);
          }

          let firstPlotTrace = {
            x,
            y,
            name: 'Progreso Diario'
          }

          let secondPlotTrace = {
            x,
            y: ySecond,
            name: 'Peso Objetivo'
          }

          let layout = {
            height: 400,
            width: 1000,
            plot_bgcolor:"black",
            paper_bgcolor:"#111111",
            xaxis: {
              showgrid: true,
              zeroline: true,
              showline: true,
              mirror: 'ticks',
              gridcolor: '#FFF3',
              gridwidth: 2,
              zerolinecolor: '#969696',
              zerolinewidth: 4,
              linecolor: '#FFF3',
              linewidth: 6
            },
            yaxis: {
              showgrid: true,
              zeroline: true,
              showline: true,
              mirror: 'ticks',
              gridcolor: '#FFF3',
              gridwidth: 2,
              zerolinecolor: '#969696',
              zerolinewidth: 4,
              linecolor: '#FFF3',
              linewidth: 6
            }
          };


          let plotData = [firstPlotTrace, secondPlotTrace];

          Plotly.newPlot(TESTER, plotData, layout);
        })();